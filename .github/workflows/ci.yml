name: CI

on:
  push:
  pull_request:

jobs:
  test-and-smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install test runner
        run: python -m pip install --upgrade pip pytest

      - name: Run pytest
        run: python -m pytest -q skills-foundry/tests

      - name: Core CLI smoke (--help)
        working-directory: skills-foundry
        run: |
          for cmd in \
            skills-new \
            skills-validate \
            skills-lint \
            skills-sync \
            skills-render \
            repo-helper-preflight \
            repo-helper-stage1-plan \
            repo-helper-postflight \
            repo-helper-stage2-theme-plan \
            repo-helper-stage2-run-plan
          do
            bin/$cmd --help >/dev/null
          done

      - name: Core validate/lint smoke
        working-directory: skills-foundry
        run: |
          bin/skills-validate >/dev/null
          bin/skills-lint >/dev/null

      - name: Scripted foundry smoke (dry-run only)
        working-directory: skills-foundry
        run: bin/smoke-check-foundry --dry-run-only
