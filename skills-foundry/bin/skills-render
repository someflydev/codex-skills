#!/usr/bin/env python3
from __future__ import annotations

import argparse
from pathlib import Path

from _skills_common import FOUNDRY_ROOT, SKILLS_ROOT, REPORTS_ROOT
from _skills_sync_render import collect_skill_entries, render_skills_catalog


def build_parser() -> argparse.ArgumentParser:
    parser = argparse.ArgumentParser(
        prog=Path(__file__).name,
        description="Render a markdown skills catalog from skills/**/SKILL.md.",
    )
    parser.add_argument("--skills-root", type=Path, default=SKILLS_ROOT)
    parser.add_argument("--output", type=Path, default=REPORTS_ROOT / "SKILLS_CATALOG.md")
    parser.add_argument("--repo-root", type=Path, default=FOUNDRY_ROOT.parent)
    return parser


def main() -> int:
    parser = build_parser()
    args = parser.parse_args()

    entries = collect_skill_entries(args.skills_root)
    output_path = render_skills_catalog(entries, args.output)
    print(f"Rendered skills catalog for {len(entries)} skills")
    print(f"- Output: {output_path}")
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
